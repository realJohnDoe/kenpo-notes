<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{{TITLE}}</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        background: #fafafa;
      }
      svg {
        width: 100%;
        height: 100vh;
        display: block;
      }
      .txt {
        font-family: sans-serif;
        font-size: 2rem;
        fill: black;
      }
    </style>
  </head>
  <body>
    <!-- SVG placeholder â€“ the generator will inject shapes/text here -->
    {{SVG_CONTENT}}

    <script src="./anime.js"></script>
    <script>
      // Timeline data is injected by the generator
      const timelineData = {{TIMELINE_JSON}};
      const labelEl = document.getElementById('stepLabel');

      const tl = anime.timeline({autoplay:true, loop:false});

      timelineData.forEach(step => {
        // Add person animations for this step
        if (step.anims && step.anims.length > 0) {
          const firstAnimation = step.anims[0];
          tl.add(firstAnimation);
          for (let i = 1; i < step.anims.length; i++) {
            tl.add(step.anims[i], `-=${firstAnimation.duration}`);
          }
        }

        // Add label animations for this step
        if (step.label && step.label.texts && step.label.texts.length > 0) {
          // Set position for all labels in this step
          tl.add({
            targets: labelEl,
            translateY: step.label.y,
            duration: 1 // Set instantly
          });

          // Loop through the labels for the current step
          step.label.texts.forEach(labelText => {
            // Fade out previous text (if any), then set new text
            tl.add({
              targets: labelEl,
              opacity: 0,
              duration: 200,
              easing: 'linear',
              complete: () => {
                labelEl.textContent = labelText;
              }
            });
            // Fade in new text and hold
            tl.add({
              targets: labelEl,
              opacity: 1,
              duration: 800,
              easing: 'linear'
            });
          });
        }

        // After all animations for a step, fade out the last label
        tl.add({
            targets: labelEl,
            opacity: 0,
            duration: 200,
            easing: 'linear'
        });
      });
    </script>
  </body>
</html>
